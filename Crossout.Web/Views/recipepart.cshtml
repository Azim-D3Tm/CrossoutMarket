@using Crossout.Web
@using Crossout.Model.Items;
@using Crossout.Model.Recipes
@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<Crossout.Model.Recipes.RecipeItem>

@{
    Item item = Model.Item;
}

<tr class="recipe-part recipe-@(Model.ParentRecipe) @(Model.Depth > 0 ? "collapse" : "")" data-recipe="@Model.Item.RecipeId" data-parentrecipe="@Model.ParentRecipe" data-superparentrecipe="@Model.SuperParentRecipe">
    <td>
        <div class="clearfix content-heading">
            <div class="clearfix vertical-center pull-left">
                @for (int i = 0; i < Model.Depth; i++)
                {
                    <div style="margin-left: 26px;">&nbsp;</div>
                }
                @if (Model.Ingredients.Count > 0)
                {
                    if (Model.Depth == 0)
                    {
                        <button class="btn btn-xs btn-main tree-icon glyphicon glyphicon-plus item-@Model.Id" data-recipe="@Model.Item.RecipeId" data-parentrecipe="@Model.ParentRecipe" data-superparentrecipe="@Model.SuperParentRecipe"></button>
                    }
                    else
                    {
                        <button class="btn btn-xs btn-sub tree-icon glyphicon glyphicon-plus item-@Model.Id" data-recipe="@Model.Item.RecipeId" data-parentrecipe="@Model.ParentRecipe" data-superparentrecipe="@Model.SuperParentRecipe"></button>
                    }
                }
                <div>
                    @if (Model.Depth == 0)
                    {
                        <a href="~/item/@item.Id"><img style="margin-right: 8px;" src="~/img/items/@item.Image"/></a>
                    }
                    else
                    {
                        <a href="~/item/@item.Id"><img style="margin-right: 8px; height: 32px;" src="~/img/items/@item.Image" /></a>
                    }
                </div>
            </div>
            @if (Model.Depth == 0)
            {
                <a href="~/item/@Model.Item.Id"><h4 style="font-weight: bold;">@Model.Item.Name</h4></a>
                <div style="font-weight: bold;">@Model.Item.TypeName</div>
            }
            else
            {
                <a href="~/item/@item.Id" style="font-weight: bold;">@item.Name</a>
                <div style="font-size: 11px; font-weight: bold;">@item.TypeName</div>
            }
        </div>
    </td>
    <td>
        <span class="label label-@item.RarityName">@item.RarityName</span>
    </td>
    <td>
        @if (Model.Depth != 0)
        {
            <div class="label-md">
                @Model.Number
            </div>
        }
    </td>
    <td>
        <div class="label-md">
            @Model.Item.FormatSellPrice <img height="14" src="~/img/Coin.png"/>
        </div>
    </td>
    <td>
        <div class="label-md">
            @Model.FormatSellPriceTimesNumber <img height="14" src="~/img/Coin.png" />
        </div>
    </td>
    <td>
        <div class="label-md">@item.SellOffers</div>
    </td>
    <td>
        <div class="label-md">
            @Model.Item.FormatBuyPrice <img height="14" src="~/img/Coin.png" />
        </div>
    </td>
    <td>
        <div class="label-md">
            @Model.FormatBuyPriceTimesNumber <img height="14" src="~/img/Coin.png"/>
        </div>
    </td>
    <td>
        <div class="label-md">@item.BuyOrders</div>
    </td>
    <td>
        <div class="label-md">
            @item.FormatMargin <img height="14" src="~/img/Coin.png"/>
        </div>
    </td>
</tr>


<script>
    $(document).ready(function() {
        var classname = 'recipe-@Model.Item.RecipeId';
        $('.item-@Model.Id').click(function () {
            var recipe = $(this).data('recipe');
            var parentRecipe = $(this).data('parentrecipe');
            var superParentRecipe = $(this).data('superparentrecipe');
            if ($(this).hasClass('glyphicon-plus')) {
                $(this).removeClass('glyphicon-plus').addClass('glyphicon-minus');
                window.updateTree(classname, recipe, parentRecipe, superParentRecipe, true);
            } else {
                $(this).removeClass('glyphicon-minus').addClass('glyphicon-plus');
                window.updateTree(classname, recipe, parentRecipe, superParentRecipe, false);
            }
        });
    });
</script>